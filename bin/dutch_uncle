#!/usr/bin/env ruby

require 'dutch_uncle'
require 'commander/import'

program :name, 'Dutch Uncle'
program :version, DutchUncle::VERSION
program :description, 'dutch uncle is watching'


command :run do |c|
  c.syntax = 'dutch_uncle run'
  c.description = "runs dutch uncle in the current directory"
  c.option '--config STRING', String, 'path to config'
  c.action do |args, options|
    options.default :config => './config.yaml'
    cli = DutchUncle::Cli.new(options.config)

    queue = Queue.new
    cli.start
    queue.pop
    at_exit do
      cli.stop
      queue.push(1)
    end
  end
end